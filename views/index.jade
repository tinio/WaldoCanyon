script
	// pass in the 'created_at' string returned from twitter //
	// stamp arrives formatted as Tue Apr 07 22:52:51 +0000 2009 //
	function parseTwitterDate($stamp)
	{		
	// convert to local string and remove seconds and year //		
		var date = new Date(Date.parse($stamp)).toLocaleString().substr(0, 16);
	// get the two digit hour //
		var hour = date.substr(-5, 2);
	// convert to AM or PM //
		var ampm = hour<12 ? ' AM' : ' PM';
		if (hour>12) hour-= 12;
		if (hour==0) hour = 12;
	// return the formatted string //
		return date.substr(0, 11)+ hour + date.substr(13) + ampm;
	}

	function fixTwitterURL(text,urls) {
			var url = '<a href="'+urls.expanded_url+'">'+urls.expanded_url+'</a>';
			var final = text.replace(urls.url, url);
			return final;
	}
	var socket = io.connect('/');
	soundManager.setup({
		url: '/swf',
		flashVersion: 9, // optional: shiny features (default = 8)
		useFlashBlock: true, // optionally, enable when you're ready to dive in/**
		useHTML5Audio: true,
		onready: function() {
			soundManager.createSound({
						id: 'ding',
						url: '/snd/ding.wav',
						autoLoad: true,
						autoPlay: false,
						onload: function() {
						},
						volume: 100
					});
			soundManager.createSound({
						id: 'streza',
						url: '/snd/Codec.wav',
						autoLoad: true,
						autoPlay: false,
						onload: function() {
						},
						volume: 100
					});
		}
	});
	socket.on('tweet', function (data) {
		console.log(data);
		if(data.entities.urls[0]) {
			var text = fixTwitterURL(data.text,data.entities.urls[0]);
		} else {
			var text = data.text;
		}
		if (!$('#pause_checkbox').is(':checked')) {
			/*if($('#pictures > a').length > 6) { 
				$('#pictures').empty(); 
			}*/
			if((data.user.screen_name == "Robbie") || (data.user.screen_name == "EPCSheriff") || (data.user.screen_name == "mayorstevebach") || (data.user.screen_name == "springsgov")) {
				//$('body').prepend('<div class="alert alert-error" id="alert_'+data.id+'"><button class="close" data-dismiss="alert">Ã—</button><strong>'+data.user.name+' (@'+data.user.screen_name+')</strong> '+text+'</div>');
				//$("#alert_"+data.id).alert()
				$('#official_tweets').prepend('<p>'+data.user.name+' (@'+data.user.screen_name+')</strong> '+text+'</p><hr>');
				soundManager.play('ding');
				//setTimeout(function() {$("#alert_"+data.id).alert('close');$("#alert_"+data.id).remove();},10000);
			} 

			if(data.entities.media) {
				if(!$('#rt_checkbox').is(':checked')) {
					// if no RT found
					if (data.text.indexOf("RT") == -1) {
						if ($('#sound_checkbox').is(':checked')) {
							soundManager.play('ding');
						}
						if ($('#streza_sound_checkbox').is(':checked')) {
							soundManager.play('streza');
						}
						$('#tweets').prepend('<tr class="tweet" id="tweet_'+data.id+'"><td>'+text+'</td><td><a href="http://twitter.com/'+data.user.screen_name+'">'+data.user.name+' (@'+data.user.screen_name+')</a></td><td>'+data.created_at+'</td>');
						$('#pictures').prepend('<a href="'+data.entities.media[0].expanded_url+'">Picture by: '+data.user.name+' (@'+data.user.screen_name+')</a><br><a href="'+data.entities.media[0].expanded_url+'" target="_blank"><img class="picture" src="'+data.entities.media[0].media_url+'" width="300" height="300"></a><hr>');
					}
				} else {
					if ($('#sound_checkbox').is(':checked')) {
						soundManager.play('ding');
					}
					if ($('#streza_sound_checkbox').is(':checked')) {
						soundManager.play('streza');
					}
					$('#tweets').prepend('<tr class="tweet" id="tweet_'+data.id+'"><td>'+text+'</td><td><a href="http://twitter.com/'+data.user.screen_name+'">'+data.user.name+' (@'+data.user.screen_name+')</a></td><td>'+data.created_at+'</td>');
					$('#pictures').prepend('<a href="'+data.entities.media[0].expanded_url+'">Picture by: '+data.user.name+' (@'+data.user.screen_name+')</a><br><a href="'+data.entities.media[0].expanded_url+'" target="_blank"><img class="picture" src="'+data.entities.media[0].media_url+'" width="300" height="300"></a><hr>');
				}
			} else {
				if(!$('#rt_checkbox').is(':checked')) {
					// if no RT found
					if (data.text.indexOf("RT") == -1) {
						if ($('#sound_checkbox').is(':checked')) {
							soundManager.play('ding');
						}
						if ($('#streza_sound_checkbox').is(':checked')) {
							soundManager.play('streza');
						}
						$('#tweets').prepend('<tr class="tweet" id="tweet_'+data.id+'"><td>'+text+'</td><td><a href="http://twitter.com/'+data.user.screen_name+'">'+data.user.name+' (@'+data.user.screen_name+')</a></td><td>'+data.created_at+'</td>')
					}
				} else {
				if ($('#sound_checkbox').is(':checked')) {
					soundManager.play('ding');
				}
				if ($('#streza_sound_checkbox').is(':checked')) {
					soundManager.play('streza');
				}
					$('#tweets').prepend('<tr class="tweet" id="tweet_'+data.id+'"><td>'+text+'</td><td><a href="http://twitter.com/'+data.user.screen_name+'">'+data.user.name+' (@'+data.user.screen_name+')</a></td><td>'+data.created_at+'</td>')
				}
			}
		}
	});

div(class="container-fluid")
	div(class="row-fluid")
		div(class="span2")
			h1 Pictures
			div(id="pictures", style="text-align:center;")
		div(class="span8")
			h1 Tweets
			p Sound
				input(type="checkbox", id="sound_checkbox", name="sound_checkbox", value="sound")
			p Pause
				input(type="checkbox", id="pause_checkbox", name="pause_checkbox", value="pause")
			p Retweets enabled
				input(type="checkbox", id="rt_checkbox", name="rt_checkbox", value="rt_enabled", checked="checked")
			table(class="table table-striped table-bordered")
				thead
					tr
						th Tweet
						th User
						th Time
				tbody(id="tweets")
		div(class="span2")
			h1 Official Messages
			div(id="official_tweets")

